# Поиск местоположения по фото

## Описание модуля
Этот модуль предоставляет функциональность для классификации изображений с использованием модели CLIP. Основные задачи включают:
1. Загрузка модели CLIP и вычисление текстовых латентов для меток.
2. Предсказание наиболее подходящей текстовой метки для входного изображения.

## Класс

### `ClipPredictor`

#### ``__init__``

##### Описание
Инициализирует объект `ClipPredictor`, загружает модель CLIP и вычисляет латенты для заданных текстовых меток.

##### Аргументы
- `clip_labels` (*list*): Список текстовых меток, используемых для классификации.
- `model_name` (*str*, по умолчанию `'ruclip-vit-base-patch32-384'`): Название модели CLIP.
- `device` (*str*, необязательный): Устройство выполнения модели (`"cuda"` или `"cpu"`). Если не указано, выбирается автоматически.

##### Пример использования
```python
clip_labels = ["кот", "собака", "автомобиль"]
predictor = ClipPredictor(clip_labels)
```

#### `_compute_text_latents`

##### Описание
Метод предварительно вычисляет латенты для текстовых меток, заданных в `clip_labels`. Латенты текстов необходимы для последующего сравнения с изображениями.

##### Аргументы
Метод не принимает аргументов. Используются метки, заданные при инициализации объекта.

##### Возвращаемое значение
- `torch.Tensor`: Латенты текстовых меток, используемые для предсказания.

##### Примечания
- Метод вызывается автоматически в конструкторе класса `ClipPredictor`.
- Для выполнения операции используется модель CLIP, загруженная при инициализации.

---

#### `predict`

##### Описание
Метод предсказывает наиболее подходящую текстовую метку для входного изображения, сравнивая его с предварительно рассчитанными текстовыми латентами.

##### Аргументы
- `image_path_or_base64` (*str*): Путь к изображению или строка, содержащая изображение в формате base64.
- `df` (*pandas.DataFrame*): DataFrame с колонкой `clip_lables`, содержащей текстовые метки.
- `is_base64` (*bool*, по умолчанию `False`): Указывает, что входное изображение передано в формате base64.

##### Возвращаемое значение
- `int`: Индекс строки в DataFrame, соответствующей предсказанной текстовой метке.

##### Алгоритм работы
1. Загружается изображение через метод `_load_image`.
2. Вычисляются предсказанные метки, используя модель CLIP и предварительно рассчитанные латенты текстов.
3. Предсказанная метка ищется в DataFrame, и возвращается индекс строки.

##### Пример использования
```python
import pandas as pd

# Пример DataFrame
data = {'clip_lables': ["кошка", "собака", "машина"]}
df = pd.DataFrame(data)

# Путь к изображению
image_path = "cat.jpg"

# Предсказание
predicted_index = predictor.predict(image_path, df)
print(f"Индекс предсказанной метки: {predicted_index}")
```

# Ответственный за разработку
1. Максим Зимаков