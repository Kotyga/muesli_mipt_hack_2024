# Поиск местоположения по тексту

## Описание
Этот модуль предоставляет функции для работы с текстовыми эмбеддингами с использованием библиотеки SentenceTransformers. Основная цель — предварительное вычисление эмбеддингов для заранее опредеёлнного списка строк и поиск наиболее похожей строки в сохранённой базе по косинусному сходству.

## Функции

### `prepare_embeddings`

#### Описание
Функция вычисляет эмбеддинги для списка строк, используя указанную модель SentenceTransformer, и сохраняет результаты в файл.

#### Аргументы
- `sentences` (*list*): Список строк, для которых требуется вычислить эмбеддинги.
- `model_name` (*str*, по умолчанию `'paraphrase-multilingual-MiniLM-L12-v2'`): Название модели SentenceTransformer, используемой для генерации эмбеддингов.

#### Возвращаемое значение
- `None`: Результат сохраняется в файл `precomputed_embeddings.pkl`.

#### Сохранённые данные
Файл `precomputed_embeddings.pkl` содержит словарь с двумя ключами:
- `sentences` (*list*): Список предложений.
- `embeddings` (*numpy.ndarray*): Матрица эмбеддингов.

#### Пример использования
```python
sentences = ["Пример текста 1", "Пример текста 2"]
prepare_embeddings(sentences)
```

### `most_similar_sentence`

#### Описание
Функция находит строку из предварительно сохранённых данных, наиболее похожую на входную строку, используя косинусное сходство между эмбеддингами строк.

#### Аргументы
- `input_string` (*str*): Входная строка, для которой требуется найти наиболее похожую строку.
- `df` (*pandas.DataFrame*): DataFrame, содержащий колонку `clip_lables`, которая хранит строки, соответствующие сохранённым предложениям.
- `embeddings_file` (*str*, по умолчанию `'precomputed_embeddings.pkl'`): Путь к файлу, содержащему сохранённые эмбеддинги строк.

#### Возвращаемое значение
- `int`: Индекс строки в DataFrame `df`, которая наиболее похожа на `input_string`.

#### Детали реализации
1. **Загрузка сохранённых данных**:
   - Открывается файл с эмбеддингами (`precomputed_embeddings.pkl`), который содержит:
     - `sentences` — список строк, для которых были рассчитаны эмбеддинги.
     - `embeddings` — матрицу эмбеддингов строк.

2. **Генерация эмбеддинга для входной строки**:
   - Используется модель SentenceTransformer (по умолчанию `'paraphrase-multilingual-MiniLM-L12-v2'`).
   - Вычисляется эмбеддинг для строки `input_string`.

3. **Расчёт косинусного сходства**:
   - Сравниваются эмбеддинги строки `input_string` с эмбеддингами из `sentence_embeddings`.
   - Находится индекс строки с максимальным сходством.

4. **Получение индекса строки**:
   - Из DataFrame `df` возвращается индекс строки, которая совпадает со строкой из сохранённых данных с максимальным сходством.

#### Пример использования
```python
import pandas as pd

# Пример DataFrame
data = {'clip_lables': ["Пример строки 1", "Пример строки 2", "Пример строки 3"]}
df = pd.DataFrame(data)

# Входная строка
input_string = "Пример строки"

# Поиск наиболее похожей строки
most_similar_index = most_similar_sentence(input_string, df)
print(f"Индекс наиболее похожей строки: {most_similar_index}")
```

# Ответственный за разработку
1. Максим Зимаков